{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Sensor Configuration</h2>
        <a href="/" class="btn btn-sm btn-ghost">Back to Dashboard</a>
    </div>
</div>

<div class="layout-grid">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{{ 'Edit Sensor' if edit_sensor else 'Add Sensor' }}</h3>
            {% if edit_sensor %}
                <a href="{{ url_for('sensors.manage_sensors') }}" class="btn btn-sm btn-ghost">Cancel</a>
            {% endif %}
        </div>

        <form method="POST" action="{{ url_for('sensors.edit_sensor', sensor_id=edit_sensor.id) if edit_sensor else url_for('sensors.manage_sensors') }}">
            <div class="form-group">
                <label class="form-label">Name</label>
                <input type="text" name="name" class="form-input" placeholder="e.g. Kitchen" required value="{{ edit_sensor.name if edit_sensor else '' }}">
            </div>

            <div class="form-group">
                <label class="form-label">GPIO Pin (BCM)</label>
                <input type="number" name="pin" class="form-input" placeholder="e.g. 17" required value="{{ edit_sensor.pin if edit_sensor else '' }}">
            </div>

            <div class="form-group">
                <label class="form-label">Type</label>
                <select name="type" class="form-select">
                    <option value="motion" {{ 'selected' if edit_sensor and edit_sensor.type=='motion' else '' }}>Motion (PIR)</option>
                    <option value="door" {{ 'selected' if edit_sensor and edit_sensor.type=='door' else '' }}>Door Contact</option>
                    <option value="relay" {{ 'selected' if edit_sensor and edit_sensor.type=='relay' else '' }}>Relay / Switch</option>
                </select>
            </div>

            <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-top: 20px;">
                <input type="checkbox" name="enabled" id="chk_enabled" {{ 'checked' if (edit_sensor and edit_sensor.enabled) or not edit_sensor else '' }}>
                <label for="chk_enabled" class="form-label" style="margin: 0; cursor: pointer;">Enabled</label>
            </div>

            <button type="submit" class="btn btn-primary btn-block mt-4">
                {{ 'Save Changes' if edit_sensor else 'Create Sensor' }}
            </button>
        </form>
    </div>

    <div class="card">
        <div class="table-container">
            <table class="glass-table">
                <thead>
                    <tr>
                        <th width="40">ID</th>
                        <th>Name</th>
                        <th>Pin</th>
                        <th>Type</th>
                        <th>State</th>
                        <th class="text-right">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sensor in sensors %}
                    <tr style="{{ 'background: var(--bg-glass-hover);' if edit_sensor and edit_sensor.id == sensor.id else '' }}">
                        <td class="text-mono text-muted">#{{ sensor.id }}</td>
                        <td><strong>{{ sensor.name }}</strong></td>
                        <td class="text-mono">{{ sensor.pin }}</td>
                        <td><span class="badge badge-gray">{{ sensor.type }}</span></td>
                        <td>
                            {% if sensor.enabled %}
                                <span class="text-success">Active</span>
                            {% else %}
                                <span class="text-muted">Disabled</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group flex-end" style="display: flex; gap: 8px;">
                                <a href="{{ url_for('sensors.edit_sensor', sensor_id=sensor.id) }}" class="btn btn-sm">Edit</a>
                                <form method="POST" action="{{ url_for('sensors.delete_sensor', sensor_id=sensor.id) }}" onsubmit="return confirm('Delete {{ sensor.name }}?');">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="6" class="text-center text-muted" style="padding: 30px;">No sensors found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}