<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Sheoak Tree Smart Monitor: real-time home presence and sensor insights with Flask and Raspberry Pi support." />
    <title>{% block title %}Sheoak Tree{% endblock %}</title>
    <script>
      (function () {
        // Critical: Run immediately to prevent Flash of Incorrect Theme (FOUC)
        const stored = localStorage.getItem("theme-preference");
        const sysDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        // logic: Storage > System > Default (Light)
        const theme = stored || (sysDark ? "dark" : "light");

        document.documentElement.setAttribute("data-theme", theme);
      })();
    </script>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code&display=swap"
      rel="stylesheet" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      window.SHEOAK_CONFIG = {{ sheoak_config | tojson }};
    </script>
    {% block head_scripts %}{% endblock %}
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to content</a>
    <nav class="card">
      <div class="card-header">
        <div class="nav-brand">Sheoak Tree</div>

        <div class="nav-menu desktop-only">
          <a
            href="{{ url_for('main.index') }}"
            class="nav-item {{ 'active' if active_page == 'live' else '' }}"
            >Live</a
          >
          <a
            href="{{ url_for('main.presence') }}"
            class="nav-item {{ 'active' if active_page == 'presence' else '' }}"
            >Presence</a
          >
          <a
            href="{{ url_for('main.analysis') }}"
            class="nav-item {{ 'active' if active_page == 'analysis' else '' }}"
            >Analysis</a
          >
          <a
            href="{{ url_for('main.ai_training') }}"
            class="nav-item {{ 'active' if active_page == 'ai' else '' }}"
            >{{ 'AI Workbench' if ai_workbench_enabled else 'AI Roadmap' }}</a
          >
          <a
            href="{{ url_for('hardwares.manage_hardwares') }}"
            class="nav-item {{ 'active' if active_page == 'config' else '' }}"
            >Config</a
          >
        </div>

        <div class="nav-controls">
          <div class="status-pill">
            <div class="status-dot connected"></div>
            <span class="desktop-only" id="connection-text">Connected</span>
          </div>
          <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark mode"></button>

          <button id="mobile-menu-toggle" class="mobile-toggle" aria-label="Menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
          </button>
        </div>
      </div>
    </nav>

    <div id="mobile-nav-overlay" class="mobile-nav-overlay">
      <div class="mobile-nav-content">
        <a
          href="{{ url_for('main.index') }}"
          class="mobile-link {{ 'active' if active_page == 'live' else '' }}">
          <i data-lucide="activity"></i> Live Monitor
        </a>
        <a
          href="{{ url_for('main.presence') }}"
          class="mobile-link {{ 'active' if active_page == 'presence' else '' }}">
          <i data-lucide="users"></i> Presence
        </a>
        <a
          href="{{ url_for('main.analysis') }}"
          class="mobile-link {{ 'active' if active_page == 'analysis' else '' }}">
          <i data-lucide="bar-chart-2"></i> Analysis
        </a>
        <a
          href="{{ url_for('main.ai_training') }}"
          class="mobile-link {{ 'active' if active_page == 'ai' else '' }}">
          <i data-lucide="brain-circuit"></i>
          {{ 'AI Workbench' if ai_workbench_enabled else 'AI Roadmap' }}
        </a>
        <a
          href="{{ url_for('hardwares.manage_hardwares') }}"
          class="mobile-link {{ 'active' if active_page == 'config' else '' }}">
          <i data-lucide="settings"></i> Configuration
        </a>
      </div>
    </div>

    <main id="main-content">
      <div id="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %} {% for
        category, message in messages %}
        <div class="alert alert-{{ 'success' if category=='success' else 'danger' }} mb-3">
          {{ message }}
        </div>
        {% endfor %} {% endif %} {% endwith %}
      </div>
      {% block content %}{% endblock %}
    </main>
    <footer>
      <p>Sheoak Tree Smart Monitor | <span id="system-time"></span></p>
    </footer>

    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    {% block scripts %}{% endblock %}
  </body>
</html>
